<form  action="<{url action=topshop_ctl_mall_admin_shop@save}>" method="post" class="form-horizontal clearfix" data-validate-onsuccess="ajaxSubmit" role="form">
  <input type="hidden" name="id" value=<{$id}>>
  <div class="panel panel-default">
    <div class="panel-heading">优选商城店铺设置</div>
    <div class="panel-body">

      <div class="form-group">
        <label for="" class="col-sm-2 control-label">店招：</label>

        <div class="col-sm-10">
			<div class="multiple-item" style="position:relative">
                <div id="removeImg_reshou" class="multiple-del glyphicon glyphicon-remove-circle" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div>
                <a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal}>" data-target="#gallery_modal">
                    <input class="reshow_logo" type="hidden" name="signs" value="<{$signs|storager}>">
                    <div class="img-put">
                        <img class="rightlogo" src="<{$signs|storager}>">
                        <i class="glyphicon glyphicon-picture"></i>
                    </div>
                </a>
				<span class="help-block">图片大小：403px*52px。</span>
            </div>
		</div>
	  </div>

		<div class="form-group">
			<label class="col-sm-2 control-label">轮播图：</label>
			<div class="col-sm-8 slideBox">
				<{if $banner}>
				<{foreach from=$banner['img'] item=item key=key}>
				<div class="row slideRow">
					<div class="col-sm-4">
						<div class="multiple-item" style="position:relative">
							<div class="multiple-del glyphicon glyphicon-remove-circle removeSlide" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div>
							<a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal}>" data-target="#gallery_modal">
								<input class="slide_input" type="hidden" name="banner[img][]" value="<{$item|storager}>">
								<div class="img-put">
									<img  class=""  src="<{$item|storager}>">
									<i class="glyphicon glyphicon-picture"></i>
								</div>
							</a>
						</div>
						<span class="help-block">图片大小：1920px*400px。</span>
					</div>
					<div class="col-sm-8">
						<input type="text" name="banner[url][]" value="<{$banner.url.$key}>" class="form-control" placeholder="轮播图链接"><span class="help-block">链接格式: http://****** 或 /wap/****</span>
						<a class="removeSlideRow" href="javascript:;">删除</a>
					</div>
				</div>
				<{/foreach}>
				<{else}>
				<!--添加幻灯片模版开始-->
				<div class="row slideRow"><div class="col-sm-4"><div class="multiple-item" style="position:relative"><div class="multiple-del glyphicon glyphicon-remove-circle removeSlide" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div><a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal}>" data-target="#gallery_modal"><input class="slide_input" type="hidden" name="banner[img][]" value=""><div class="img-put"><img  class=""  src=""><i class="glyphicon glyphicon-picture"></i></div></a></div><span class="help-block">图片大小：1920px*400px。</span></div><div class="col-sm-8"><input type="text" name="banner[url][]" value="" class="form-control" placeholder="轮播图链接"><span class="help-block">链接格式: http://****** 或 /wap/****</span><a class="removeSlideRow" href="javascript:;">删除</a></div></div>
				<!--添加幻灯片模版结束-->
				<{/if}>
			</div>
			<div class="col-sm-1">
				<a class="btn btn-default addSlideRow" href="javascript:;">添加</a>
			</div>
		</div>




		<div class="form-group">
			<label class="col-sm-2 control-label">广告图片：</label>
			<div class="col-sm-8">

				<div class="row slideRow">
					<div class="col-sm-4">
						<div class="multiple-item" style="position:relative">
							<div class="multiple-del glyphicon glyphicon-remove-circle removeSlide" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div>
							<a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal}>" data-target="#gallery_modal">
								<input class="slide_input" type="hidden" name="ad_pic[img][]" value="<{$ad_pic.img.0}>">
								<div class="img-put">
									<img  class=""  src="<{$ad_pic.img.0}>">
									<i class="glyphicon glyphicon-picture"></i>
								</div>
							</a>
						</div>
						<span class="help-block">图片大小：590px*130px。</span>
					</div>
					<div class="col-sm-8">
						<input type="text" name="ad_pic[url][]" value="<{$ad_pic.url.0}>" class="form-control" placeholder="轮播图链接"><span class="help-block">链接格式: http://****** 或 /wap/****</span>
					</div>
				</div>

				<div class="row slideRow">
					<div class="col-sm-4">
						<div class="multiple-item" style="position:relative">
							<div class="multiple-del glyphicon glyphicon-remove-circle removeSlide" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div>
							<a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal}>" data-target="#gallery_modal">
								<input class="slide_input" type="hidden" name="ad_pic[img][]" value="<{$ad_pic.img.1}>">
								<div class="img-put">
									<img  class=""  src="<{$ad_pic.img.1}>">
									<i class="glyphicon glyphicon-picture"></i>
								</div>
							</a>
						</div>
						<span class="help-block">图片大小：590px*130px。</span>
					</div>
					<div class="col-sm-8">
						<input type="text" name="ad_pic[url][]" value="<{$ad_pic.url.1}>" class="form-control" placeholder="轮播图链接"><span class="help-block">链接格式: http://****** 或 /wap/****</span>
					</div>
				</div>

			</div>

		</div>

    </div>
  </div>


  <div class="panel panel-default select-goods-panel">
    <div class="panel-heading">
		选择推荐商品
    </div>
    <div class="panel-body">
      <button class="btn btn-md btn-block btn-danger select-goods" data-remote="<{url action=topshop_ctl_selector_item@loadSelectGoodsModal mall=1}>" data-item_id="<{$notEndItem}>" data-textcol="title,price" data-target="#goods_modal" data-fetchgoods="<{url action=topshop_ctl_selector_item@formatSelectedGoodsRow}>" data-limit="2">选择商品</button>
      <div class="selected-goods-list">

      </div>
    </div>
  </div>



  <div class="row">
    <div class="col-md-4">

    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-primary btn-lg btn-block action-save">保存</button>
    </div>
    <{*<div class="col-md-2">
       <a href="<{url action="topshop_ctl_promotion_fullminus@list_fullminus"}>"><button type="button" class="btn btn-default btn-lg btn-block action-cancel">取消</button></a>
    </div>*}>
    <div class="col-md-4">

    </div>
  </div>
</form>
<script>


function ajaxSubmit (e) {
  var form = e.target;
  e.preventDefault();
  $.post(form.action, $(form).serialize(), function(rs) {
    if(rs.error) {
      $('#messagebox').message(rs.message);
      return;
    }
    if(rs.success) {
      $('#messagebox').message(rs.message, 'success');
    }
    if(rs.redirect) {
      location.href = rs.redirect;
    }
  });
}


/*添加轮播图模版开始*/
var _html = '<div class="row slideRow"><div class="col-sm-4"><div class="multiple-item" style="position:relative"><div class="multiple-del glyphicon glyphicon-remove-circle removeSlide" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div><a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal}>" data-target="#gallery_modal"><input class="slide_input" type="hidden" name="banner[img][]" value=""><div class="img-put"><img  class=""  src=""><i class="glyphicon glyphicon-picture"></i></div></a></div><span class="help-block">图片大小：1920px*400px。</span></div><div class="col-sm-8"><input type="text" name="banner[url][]" value="" class="form-control" placeholder="轮播图链接"><span class="help-block">链接格式: http://****** 或 /wap/****</span><a class="removeSlideRow" href="javascript:;">删除</a></div></div>';
/*添加幻灯片模版结束*/
$('.addSlideRow').on('click', function () {
	$(".slideBox").append(_html);
});
$('.slideBox').on('click', '.removeSlideRow', function () {
	$(this).parent().parent().remove();
	if($('.slideRow').length < 1){
		$(".slideBox").append(_html);
	}
})
$('.slideBox').on('click', '.removeSlide', function(){
	var tas_obj = $(this).parent().find('.slide_input');
	tas_obj.val("");
	tas_obj.next('.img-put').find('img').attr('src','');
	tas_obj.next('.img-put').append('<i class="glyphicon glyphicon-picture"></i>');
});

</script>
