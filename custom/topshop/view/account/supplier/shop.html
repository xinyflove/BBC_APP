<div class="panel panel-default">
  <form  action="<{url action=topshop_ctl_account_supplier@agentShopSave}>" method="post" class="form-horizontal" data-validate-onsuccess="ajaxSubmit" id="form_delivery" role="form">
    <input type="hidden" name="supplier_id" value="<{$supplier_id}>">
    <input type="hidden" name="agent_shop_id" id="agent_shop_id" value="<{$data.agent_shop_id}>">
    <div class="panel-body">
      <div class="form-group">
        <label class="col-sm-2 control-label" >线下店名称：</label>
        <div class="col-sm-4">
          <input type="text" name="name" value="<{$data.name}>" class="form-control" placeholder="线下店名称" required>
        </div>
      </div>
      <hr/>
      <div class="form-group">
      	<label class="col-sm-2 control-label" >线下店基本信息：</label>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">线下店类型：</label>
        <div class="col-sm-4">
          <select name="type" class="input-sm" required>
          	<option value="HOME" <{if $data.type == 'HOME'}>selected<{/if}>>总店</option>
            <{if $shop.offline_multi == 'on'}>
          	<option value="SUB" <{if $data.type == 'SUB'}>selected<{/if}>>分店</option>
            <{/if}>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label">线下店分类：</label>
        <div class="col-sm-4">
          <select name="agent_category_id" class="input-sm" required>
            <{if empty($data['agent_category_id'])}>
            <option value="">请选择分类</option>
            <{/if}>
            <{foreach from=$agentCatData item=vo}>
                <option value="<{$vo.agent_category_id}>" <{if isset($data) && !empty($data['agent_category_id']) && $data['agent_category_id'] == $vo.agent_category_id}>selected<{/if}>><{$vo.agent_category_name}></option>
            <{/foreach}>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >账号：</label>
        <div class="col-sm-4">
          <{if $data.login_account}>
          <input  name='login_account' type='text' value="<{$data.login_account}>" placeholder="线下店账号" required readonly class="form-control" >
          <{else}>
          <input  name='login_account' type='text' value="<{$supplier.login_account_default}>" readonly placeholder="线下店账号" required class="form-control" >
          <{/if}>
        </div>
      </div>
      <{if empty($data.login_password)}>
      <div class="form-group">
        <label class="col-sm-2 control-label" >密码：</label>
        <div class="col-sm-4">
          <input  name='login_password' id="inp-fon" type='text' value="qdgd8888" placeholder=""  class="form-control" >
        </div>
      </div>
      <{/if}>
      <div class="form-group">
        <label class="col-sm-2 control-label" >联系人：</label>
        <div class="col-sm-4">
          <{if $data.supplier_name}>
          <input  name='linkman' type='text' value="<{$data.linkman}>" placeholder="联系人姓名" required class="form-control" >
          <{else}>
          <input  name='linkman' type='text' value="<{$data.linkman}>" placeholder="联系人姓名" required class="form-control" >
          <{/if}>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >联系人手机号：</label>
        <div class="col-sm-4">
          <{if !empty($data.sh_phone)}>
          <input type="tel" name='mobile' value="<{$data.mobile}>" placeholder="联系人电话" required class="form-control" >
          <{else}>
          <input type="tel" name='mobile' value="<{$data.mobile}>" placeholder="联系人电话" required class="form-control" >
          <{/if}>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >店家座机号：</label>
        <div class="col-sm-4">
          <input type="tel" name='fixed_phone' value="<{$data.fixed_phone}>" placeholder="店家座机号" required class="form-control" >
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >联系人邮箱：</label>
        <div class="col-sm-4">
          <{if !empty($data.email)}>
          <input type="email" name='email' value="<{$data.email}>" placeholder="联系人邮箱" class="form-control" >
          <{else}>
          <input type="email" name='email' value="<{$data.email}>" placeholder="联系人邮箱" class="form-control" >
          <{/if}>
        </div>
      </div>
      <div class="form-group">
          <label class="col-sm-2 control-label" >联系人身份证号：</label>
          <div class="col-sm-4">
              <{if !empty($data.id_number)}>
              <input type="text" name='id_number' value="<{$data.id_number}>" placeholder="联系人身份证号" required class="form-control" >
              <{else}>
              <input type="text" name='id_number' value="<{$data.id_number}>" placeholder="联系人身份证号" required class="form-control" >
              <{/if}>
          </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >营业执照编号：</label>
        <div class="col-sm-4">
          <input type="text" name='licences_no' value="<{$data.licences_no}>" placeholder="营业执照编号" required class="form-control">
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >分佣比例：</label>
        <div class="col-sm-4">
          <input type="text" name='sub_ratio' value="<{$data.sub_ratio}>" placeholder="分佣比例" required class="form-control">
          <span class="help-block">单位:(%)  比例为915分得费用比例。</span>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >选择省市区</label>
        <div class="col-sm-4">
          <input name='district' type='text' id="district" readonly value="<{$data.district}>" placeholder="省市区代码" required class="form-control" >
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >线下店地址描述：</label>
        <div class="col-sm-4">
          <input name='addr_desc' type='text' id="spec_address_desc" value="<{$data.addr_desc}>" placeholder="线下店地址描述" required class="form-control" >
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >线下店人均消费：</label>
        <div class="col-sm-4">
          <input name='shop_consumption' type='text'  value="<{$data.shop_consumption}>" placeholder="线下店人均消费" class="form-control" >
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >线下店地址：</label>
        <div class="col-sm-4">
          <{if !empty($data.addr)}>
          <input name='addr' type='text' id="spec_address" value="<{$data.addr}>" placeholder="线下店地址" required class="form-control" >
          <{else}>
          <input name='addr' type='text' id="spec_address" value="<{$data.addr}>" placeholder="线下店地址" required class="form-control" >
          <{/if}>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" >经度：</label>
        <div class="col-sm-4">
          <{if !empty($data.lon)}>
          <input type="number" name="lon" value="<{$data.lon}>" id="lon" class="form-control" placeholder="最多50个字符" required maxlength="50">
          <{else}>
          <input type="number" name="lon" value="<{$data.lon}>" id="lon" class="form-control" placeholder="最多50个字符" required maxlength="50">
          <{/if}>
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-2 control-label" >纬度：</label>
        <div class="col-sm-4">
          <{if !empty($data.lat)}>
          <input type="number" name="lat" value="<{$data.lat}>" id="lat" class="form-control" placeholder="最多50个字符" required maxlength="50">
          <{else}>
          <input type="number" name="lat" value="<{$data.lat}>" id="lat" class="form-control" placeholder="最多50个字符" required maxlength="50">
          <{/if}>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" ></label>
        <div class="col-sm-4">
          <div class="panel-body">
            <button  type="button" class="btn btn-md btn-block btn-danger select-map" data-remote="<{url action=topshop_ctl_selector_map@loadMapModal}>"  style="background-color: #468ebc;border-color: #468ebc" data-target="#gdmap_modal">选择坐标点</button>

          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="" class="col-sm-2 control-label">详情页轮播图：</label>
        <div class="col-sm-10">
          <div class="multiple-upload pro-thumb" >
            <{if $data.carouse_image_list}>
            <{foreach from=$data.carouse_image_list item=image_id key=key }>
            <div class="multiple-item">
              <div class="multiple-del glyphicon glyphicon-remove-circle"></div>
              <a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal isOnlyShow=item}>" data-target="#gallery_modal">
                <input type="hidden" name="carouse_image_list[]" value="<{$image_id}>">
                <div class="img-put"><img src="<{$image_id|storager:t}>"></div>
              </a>
            </div>
            <{/foreach}>
            <{/if}>
            <div class="multiple-add" data-toggle="modal" data-isMultiple="true" data-target="#gallery_modal" data-name="carouse_image_list[]" data-limit="10" href="<{url action=topshop_ctl_shop_image@loadImageModal isOnlyShow=item}>" ><i class="glyphicon glyphicon-plus"></i></div>
          </div>
        </div>
        <label for="" class="col-sm-2 control-label"></label>
        <span class="help-block">参考尺寸：750*360 px。</span>
      </div>

      <div class="form-group">
        <label for="" class="col-sm-2 control-label">封面图：</label>
        <div class="col-sm-10">
          <div class="multiple-item" style="position:relative">
            <div class="multiple-del glyphicon glyphicon-remove-circle removeTopAdSlide" style="position: absolute;left: 60px;top: -5px;z-index: 999;"></div>
            <a class="select-image" data-toggle="modal" href="<{url action=topshop_ctl_shop_image@loadImageModal isOnlyShow=item}>" data-target="#gallery_modal">
              <input type="hidden" name="agent_img_src" value="<{$data.agent_img_src}>">
              <div class="img-put">
                <img src="<{$data.agent_img_src|storager:t}>">
                <i class="glyphicon glyphicon-picture"></i>
              </div>
            </a>
          </div>
        </div>
        <label for="" class="col-sm-2 control-label"></label>
        <span class="help-block">参考尺寸：220*220 px。</span>
      </div>

      <hr>
      <div class="form-group">
        <label class="col-sm-2 control-label" >银行卡基本信息：</label>
      </div>
      <div class="nav-tabs-custom" id="per_bank_info" style="margin-left:50px;">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active" id="pa_bank">
            <a href="javascript:void(0)">平安银行</a>
          </li>
          <li role="presentation" id="ns_bank">
            <a href="javascript:void(0)">农商银行</a>
          </li>
          <li role="presentation"  id="qd_bank" style="display:none;">
            <a href="javascript:void(0)">青岛银行</a>
          </li>
        </ul>
      </div>
      <div id="bank_config">
        <div id="pa_bank_config" >
          <div class="form-group">
            <label class="col-sm-2 control-label">对公\对私：</label>
            <div class="col-sm-4">
              <select name="pa_bank[is_public]" class="input-sm" <{if $data.payment.pa_bank.is_public}>onfocus="this.defaultIndex=this.selectedIndex;" onchange="this.selectedIndex=this.defaultIndex;"<{/if}> required>
              <option value="BANK_PUBLIC" <{if $data.payment.pa_bank.is_public == 'BANK_PUBLIC'}>selected<{/if}>>对公</option>
              <option value="BANK_PRIVATE" <{if $data.payment.pa_bank.is_public == 'BANK_PRIVATE'}>selected<{/if}>>对私</option>
              </select>
            </div>
            <input type="checkbox" name="pa_bank[is_open]" <{if $data.payment.pa_bank.is_open === on}>checked<{/if}>/>是否启用
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >开户行：</label>
            <div class="col-sm-4">
              <input  name='pa_bank[deposit_bank]' <{if $data.payment.pa_bank.deposit_bank}>readonly<{/if}> type="text" value="<{$data.payment.pa_bank.deposit_bank}>" placeholder="开户行名称"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >银行卡号：</label>
            <div class="col-sm-4">
              <input  name='pa_bank[card_number]' type="number" <{if $data.payment.pa_bank.card_number}>readonly<{/if}> value="<{$data.payment.pa_bank.card_number}>" placeholder="银行卡号"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >账号名称：</label>
            <div class="col-sm-4">
              <input  name='pa_bank[card_account_name]' <{if $data.payment.pa_bank.card_account_name}>readonly<{/if}> type="text" value="<{$data.payment.pa_bank.card_account_name}>" placeholder="账号名称"  class="form-control" >
            </div>
          </div>
        </div>
        <div id="ns_bank_config" style="display:none;">
          <div class="form-group">
            <label class="col-sm-2 control-label">对公\对私：</label>
            <div class="col-sm-4">
              <select name="ns_bank[is_public]" class="input-sm" <{if $data.payment.ns_bank.is_public}>onfocus="this.defaultIndex=this.selectedIndex;" onchange="this.selectedIndex=this.defaultIndex;"<{/if}> required>
              <option value="BANK_PUBLIC" <{if $data.payment.ns_bank.is_public == 'BANK_PUBLIC'}>selected<{/if}>>对公</option>
              <option value="BANK_PRIVATE" <{if $data.payment.ns_bank.is_public == 'BANK_PRIVATE'}>selected<{/if}>>对私</option>
              </select>
            </div>
            <input type="checkbox" name="ns_bank[is_open]" <{if $data.payment.ns_bank.is_open === on}>checked<{/if}>/>是否启用
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >开户行：</label>
            <div class="col-sm-4">
              <input  name='ns_bank[deposit_bank]' <{if $data.payment.ns_bank.deposit_bank}>readonly<{/if}> type="text" value="<{$data.payment.ns_bank.deposit_bank}>" placeholder="开户行名称"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >银行卡号：</label>
            <div class="col-sm-4">
              <input  name='ns_bank[card_number]' type="number" <{if $data.payment.ns_bank.card_number}>readonly<{/if}> value="<{$data.payment.ns_bank.card_number}>" placeholder="银行卡号"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >账号名称：</label>
            <div class="col-sm-4">
              <input  name='ns_bank[card_account_name]' <{if $data.payment.ns_bank.card_account_name}>readonly<{/if}> type="text" value="<{$data.payment.ns_bank.card_account_name}>" placeholder="账号名称"  class="form-control" >
            </div>
          </div>
          <{if $data.payment.ns_bank.twolecomm_id}>
          <div class="form-group">
            <label class="col-sm-2 control-label" >二级商户标识：</label>
            <div class="col-sm-4">
              <input  name='ns_bank[twolecomm_id]' readonly type="text" value="<{$data.payment.ns_bank.twolecomm_id}>" placeholder="账号名称"  class="form-control" >
            </div>
          </div>
          <{/if}>
          <div class="form-group">
            <label class="col-sm-2 control-label" >行业类目：</label>
            <div class="col-sm-3">
              <button type="button" data-toggle="modal" data-target="#categoryDialog" class="btn btn-default btn-sm btn-category">选择类目</button>&nbsp;&nbsp;
              <span class="category-choose-txt" data-id=""></span>
              <{include file="topshop/bank/bank_category.html"}>
              <input type="hidden" name="ns_bank[category_code]" value="" />
            </div>
            <{if $data.payment.ns_bank.is_enter === 0}>
            <button type="button" data-bank="ns_bank" style="margin-left:36px;" class="btn btn-primary btn-flat merchant_entry"><{t}>入驻<{/t}></button>
            <{/if}>
          </div>
          <div class="form-group">
          </div>
        </div>
        <div id="qd_bank_config" style="display:none;">
          <div class="form-group">
            <label class="col-sm-2 control-label">对公\对私：</label>
            <div class="col-sm-4">
              <select name="qd_bank[is_public]" class="input-sm" <{if $data.payment.qd_bank.is_public}>onfocus="this.defaultIndex=this.selectedIndex;" onchange="this.selectedIndex=this.defaultIndex;"<{/if}> required>
              <option value="BANK_PUBLIC" <{if $data.payment.qd_bank.is_public == 'BANK_PUBLIC'}>selected<{/if}>>对公</option>
              <option value="BANK_PRIVATE" <{if $data.payment.qd_bank.is_public == 'BANK_PRIVATE'}>selected<{/if}>>对私</option>
              </select>
            </div>
            <input type="checkbox" name="qd_bank[is_open]" <{if $data.payment.qd_bank.is_open === on}>checked<{/if}>/>是否启用
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >开户行：</label>
            <div class="col-sm-4">
              <input  name='qd_bank[deposit_bank]' <{if $data.payment.qd_bank.deposit_bank}>readonly<{/if}> type="text" value="<{$data.payment.qd_bank.deposit_bank}>" placeholder="开户行名称"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >银行卡号：</label>
            <div class="col-sm-4">
              <input  name='qd_bank[card_number]' type="number" <{if $data.payment.qd_bank.card_number}>readonly<{/if}> value="<{$data.payment.qd_bank.card_number}>" placeholder="银行卡号" class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >账号名称：</label>
            <div class="col-sm-4">
              <input  name='qd_bank[card_account_name]' <{if $data.payment.qd_bank.card_account_name}>readonly<{/if}> type="text" value="<{$data.payment.qd_bank.card_account_name}>" placeholder="账号名称"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >商户号：</label>
            <div class="col-sm-4">
              <input  name='qd_bank[mer_id]' <{if $data.payment.qd_bank.mer_id}>readonly<{/if}> type="text" value="<{$data.payment.qd_bank.mer_id}>" placeholder="商户号"  class="form-control" >
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" >终端号：</label>
            <div class="col-sm-4">
              <input  name='qd_bank[mer_tid]' <{if $data.payment.qd_bank.mer_tid}>readonly<{/if}> type="text" value="<{$data.payment.qd_bank.mer_tid}>" placeholder="终端号"  class="form-control" >
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer text-center">
      <button type="submit" class="btn btn-primary btn-flat"><{t}>保存<{/t}></button>
    </div>

  </form>
</div>
<script>
  each_category("<{$data.payment.ns_bank.category_code}>");
  $('.list-group-brand').find('a').click(function(){
      var category_name = $.trim($(this).html());
      $(this).addClass('active').siblings().removeClass('active');
      $('.category-choose-txt').html(category_name);
      $('.category-choose-txt').attr('data-id', $(this).data('category_code'));
      $('.category-foot span').html(category_name);
      $('input[name="ns_bank[category_code]"]').val($(this).data('category_code'));
  });
  var timer = false;
  $('#search_category').bind('input propertychange',function(){
      var category_name = $('#search_category').val();
      if(timer)
      {
          clearTimeout(timer);
      }
      timer = setTimeout(function(){
          each_category(category_name);
      },500);

  });

  function each_category(category)
  {
      if(category == '')
      {
          $('.list-group-brand').find('a').show();
          return false;
      }
      var categoryList = $('.list-group-brand').find('a');
      $.each(categoryList, function(k, v)
      {
          if($.trim($(this).html()) == category || $(this).data('category_code') == category)
          {
              $(this).show();
              $(this).addClass('active');
              $('.category-choose-txt').html($(this).data('category_name'));
              $('.category-choose-txt').attr('data-id', $(this).data('category_code'));
              $('.category-foot span').html($(this).data('category_name'));
              $('input[name="ns_bank[category_code]"]').val($(this).data('category_code'));
          }
          else
          {
              $(this).hide();
              $(this).removeClass('active');
          }
      })
  }

  $('.merchant_entry').click(function(){
      var agent_shop_id = $('#agent_shop_id').val();
      var bank = $(this).data('bank');
      $.ajax({
          url: '<{url action=topshop_ctl_account_supplier@ajaxMerchantEntry}>',
          type: 'post',
          dataType: 'json',
          data: {
              'agent_shop_id':agent_shop_id,
              'bank': bank
          },
          success: function(res)
          {
              if(res.result === 'SUCCESS')
              {
                  $('#messagebox').message(res.message, 'success');
                  location.href = res.url;
              }
              else
              {
                  $('#messagebox').message(res.message);
              }
          }
      });
  })

  function ajaxSubmit (e) {
   	var form = e.target;
    e.preventDefault();
    $.post(form.action, $(form).serialize(), function(rs) {
      if(rs.error) {
        $('#messagebox').message(rs.message);
        return;
      }
      if(rs.success) {
        $('#messagebox').message(rs.message, 'success');
      }
      if(rs.redirect) {
        location.href = rs.redirect;
      }
    });
  }

  $('#per_bank_info').find('li').click(function() {
      var click_id = $(this).attr('id');
      $('#bank_config').find('#'+click_id+'_config').show().siblings().hide();
      $(this).addClass('active').siblings().removeClass('active');
  })
  //拖拽图片
  dragDom('.multiple-item');
  //默认密码
  $("#inp-fon").focus(function(){
      var oldValue = $(this).val();
      if(oldValue == this.defaultValue){
          $(this).val("").addClass('focus-fon');
      }
  }).blur(function(){
      var oldValue = $(this).val();
      if(oldValue == ""){
          $(this).val(this.defaultValue).removeClass('focus-fon');
      }
  });
</script>
