<aside class="control-sidebar control-sidebar-light" style="height: 100%;">
  <!-- Create the tabs -->
  <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
    <li class=""><a href="#">筛选</a></li>
    <li class=""><a href="#" data-toggle="control-sidebar"><i class="glyphicon glyphicon-remove"></i></a></li>
  </ul>
  <!-- Tab panes -->
  <div class="tab-content">
    <form action="<{url action=topshop_ctl_trade_list@search}>" method="post" role="form" data-validate-onsuccess="ajaxSuccess">
      <input type="hidden" value="<{$filter.status}>" id="filter_status">
      <input type="hidden" value="<{$filter.settlement_status}>" id="filter_settlement_status">
      <div class="box-body">
        <!-- Date range -->
        <div class="form-group">
          <label>下单时间:</label>

          <div class="input-group">
            <div class="input-group-addon">
              <i class="fa fa-calendar"></i>
            </div>
            <input type="text" name="create_time" class="form-control pull-right reservation">
          </div>
          <!-- /.input group -->
        </div>
        <!-- /.form group -->

        <!-- text input -->
        <div class="form-group">
          <label>订单号：</label>
          <input type="text" name="tid" class="form-control" placeholder="请输入 ...">
        </div>

        <!-- select -->
        <div name="status" class="form-group">
          <label>订单状态</label>
          <select name="status" class="form-control select-reset">
            <{foreach from=$status item=value key=key}>
            <option value="<{$key|escape:"html"}>"><{$value|escape:"html"}></option>
            <{/foreach}>
          </select>
        </div>

        <!-- text input -->
        <div class="form-group">
            <label>运单号：</label>
            <input type="text" name="logi_no" class="form-control" placeholder="请输入 ...">
        </div>
        <div class="form-group">
          <label>会员帐号：</label>
          <input type="text" name="user_name" class="form-control" placeholder="请输入 ...">
        </div>
        <div class="form-group">
          <label>收货人：</label>
          <input type="text" name="receiver_name" class="form-control" placeholder="请输入 ...">
        </div>
        <div class="form-group">
          <label>收货人手机：</label>
          <input type="text" name="receiver_mobile" class="form-control" placeholder="请输入 ...">
        </div>
        <!--  <div class="form-group">
          <label>收货人电话：</label>
          <input type="text" name="receiver_phone" class="form-control" placeholder="请输入 ...">
        </div> -->
        <!--add_201709241653_by_wudi_start-->
        <div class="form-group">
          <label>商品名称/关键词：</label>
          <input type="text" name="keyword" class="form-control" placeholder="请输入 ...">
        </div>

        <div class="form-group">
          <label>商品类型(实物/虚拟)</label>
          <select name="is_virtual" class="form-control select-reset">
            <{foreach from=$is_virtual item=value key=key}>
            <option value="<{$key|escape:"html"}>"><{$value|escape:"html"}></option>
            <{/foreach}>
          </select>
          <input type="hidden" value="<{$filter.status}>" id="filter_status">
        </div>

		
        <!--add_2018/10/31_by_wanghaichao_start-->
        <div class="form-group">
          <label>订单类型(自卖/代售)：</label>
          <select name="type" class="form-control select-reset">
            <option value="all">全部</option>
            <option value="self">自卖</option>
            <option value="sale">代售</option>
          </select>
        </div>
        <!--add_2018/10/31_by_wanghaichao_start-->

        <div class="form-group">
          <label>供应商名称：</label>
          <select name="supplier_id" class="form-control select-reset">
            <option value="">全部</option>
            <option value="0">店铺自营</option>
            <{foreach from=$suppliers item=value key=key}>
            <option value="<{$value.supplier_id}>"><{$value.company_name|escape:"html"}></option>
            <{/foreach}>
          </select>
        </div>

        <!--add_201709241653_by_wudi_start-->

        <!-- select -->
        <!--del_20170923_by_wudi_start-->
        <!--<div class="form-group">
          <label>结算状态</label>
          <select name="settlement_status" class="form-control select-reset">
            <{foreach from=$settlement_status item=value key=key}>
            <option value="<{$key|escape:"html"}>"><{$value|escape:"html"}></option>
            <{/foreach}>
          </select>
        </div>-->
        <!--del_20170923_by_wudi_start-->
      </div>

      <!-- /.box-body -->
      <div class="box-footer">
        <button type="button" class="btn btn-default" id="reset-form">重置</button>
        <button type="submit" class="btn btn-info pull-right">搜索</button>
      </div>
      <!-- /.box-footer -->
    </form>
  </div>
</aside>

<div class="nav-tabs-custom" id="tabs">
  <ul class="nav nav-tabs">
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_0" data-toggle="tab">全部</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_1" data-toggle="tab">待支付</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_2" data-toggle="tab">待发货</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_3" data-toggle="tab">待收货</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_4" data-toggle="tab">已收货</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_5" data-toggle="tab">已取消</a></li>
    <{if $shop_type == "self"}>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_6" data-toggle="tab">货到付款</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_7" data-toggle="tab">自提订单</a></li>
    <{/if}>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_8" data-toggle="tab">待核销</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_9" data-toggle="tab">部分核销</a></li>
    <li><a href="<{url action=topshop_ctl_trade_list@search}>#tab_10" data-toggle="tab">全部核销</a></li>
    <li class="pull-right header export-filter" data-value="" data-app="" data-model="">
      <div class="btn-group">
        <a href="<{url action=topshop_ctl_exporttrade@view app=systrade model=trade orderBy=tid}>" data-model="trade" data-app="systrade" class="btn btn-box-tool btn-export" data-widget="more" data-toggle="tooltip" title="" data-original-title="订单导出">
          <i class="glyphicon glyphicon-open"></i>
        </a>
        <a href="<{url action=topshop_ctl_exporttrade@vieworder app=systrade model=order orderBy=tid}>" data-model="order" data-app="systrade" class="btn btn-box-tool btn-exportorder" data-widget="more" data-toggle="tooltip" title="" data-original-title="子订单导出">
          <i class="glyphicon glyphicon-export"></i>
        </a>
        <a href="<{url action=topshop_ctl_import@import app=systrade model=trade orderBy=tid}>" data-model="order" data-app="systrade" class="btn btn-box-tool btn-import" data-widget="more" data-toggle="tooltip" title="" data-original-title="批量发货">
          <i class="glyphicon glyphicon-import"></i>
        </a>
        <button data-toggle="control-sidebar" class="btn btn-box-tool">
          <i class="glyphicon glyphicon-search text-light-blue"></i>
        </button>
      </div>
      <!-- /.btn-group -->
    </li>
  </ul>
  <div class="tab-content no-padding">
    <div class="tab-pane" id="tab_0">
    </div><!-- /.tab-pane -->
    <div class="tab-pane" id="tab_1">

    </div><!-- /.tab-pane -->
    <div class="tab-pane" id="tab_2">

    </div><!-- /.tab-pane -->
    <div class="tab-pane" id="tab_3">

    </div><!-- /.tab-pane -->
    <div class="tab-pane" id="tab_4">

    </div><!-- /.tab-pane -->
    <div class="tab-pane s" id="tab_5">

    </div><!-- /.tab-pane -->
    <{if $shop_type == "self"}>
    <div class="tab-pane" id="tab_6">
    </div>
    <div class="tab-pane" id="tab_7">
    </div><!-- /.tab-pane -->
    <{/if}>
    <div class="tab-pane" id="tab_8"></div><!-- /.tab-pane -->
    <div class="tab-pane" id="tab_9"></div><!-- /.tab-pane -->
    <div class="tab-pane" id="tab_10"></div><!-- /.tab-pane -->
  </div>
  <!-- /.tab-content -->
</div>
<!-- /.nav-tabs-custom -->

<!--订单取消弹框-->
<div class="modal fade" id="orderCancel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

    </div>
  </div>
</div>
<!--订单修改弹框-->
<div class="modal fade" id="orderEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    </div>
  </div>
</div>
<div class="modal fade" id="orderPriceEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

    </div>
  </div>
</div>
<!--特殊情况订单取消弹框-->
<div class="modal fade" id="orderCancelSpecial">
  <div class="modal-dialog">
    <div class="modal-content">

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--订单收款并完成 -->
<div class="modal fade" id="orderFinish" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

    </div>
  </div>
</div>

<div class="modal fade" id="delivery" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    </div>
  </div>
</div>

<!--订单拒收弹框-->
<div class="modal fade" id="orderRejection" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog order-rejection">
    <div class="modal-content">
    </div>
  </div>
</div>

<!--发送自提提货码弹出框-->
<div class="modal fade" id="sendDeliverySms" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog send-delivery-sms">
    <div class="modal-content">
    </div>
  </div>
</div>

<!--验证自提提货码弹出框-->
<div class="modal fade" id="checkDeliveryVcode" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog check-delivery-vcode">
    <div class="modal-content">
    </div>
  </div>
</div>

<script>
    $('.reservation').daterangepicker({
        format: 'YYYY/MM/DD',
        opens: 'right'
    });
    $('.reservation').val('');

    $('#tabs a[data-toggle="tab"]').on('show.bs.tab', function (e) {
        var tabhref = $(this).attr('href');
        var tab = tabhref.split("#")[1];
        var status = tab.split("_")[1];
        var useSessionFilter = '<{$useSessionFilter}>';

        //交易搜索后 保留搜索条件
        if(useSessionFilter){
            var username =  $("form input[name=user_name]").val();
            var createtime =  $("form input[name=create_time]").val();
            var tid =  $("form input[name=tid]").val();
            var receiver_name =  $("form input[name=receiver_name]").val();
            var receiver_mobile =  $("form input[name=receiver_mobile]").val();
            var settlement_status =  $("form input[name=settlement_status]").val();
            var receiver_phone =  $("form input[name=receiver_phone]").val();

            $('#'+tab).load(tabhref,{'status':status,'user_name':username,'create_time':createtime,'receiver_name':receiver_name,'receiver_mobile':receiver_mobile,'settlement_status':settlement_status,'receiver_phone':receiver_phone,'tid':tid });
        }else{
            $('#'+tab).load(tabhref,{'status':status});
        }
        //$("form input[name=status]").val($(this).text());
        $("form select[name=status]").val(status);
        $('#'+tab).load(tabhref,$('form').serialize());
        //$('#'+tab).load(tabhref,{'status':status});
        $('#filter_status').val(status);
    }).eq($('#filter_status').val()).trigger('click');

    function ajaxSuccess(e) {
        var form = e.target;
        $(form).find('button[type=submit]').prop('disabled', false);
        e.preventDefault();
        $.post(form.action, $(form).serialize(),function(rs){
            var status = $(form).find('select[name=status]').val();
            //$('#tabs a[data-toggle="tab"]').eq(status).trigger('click');
            $('#tabs a[data-toggle="tab"]').eq(status).parent().addClass('active').siblings().removeClass('active');

            $('#tabs .tab-pane.active').html(rs);

            $('.control-sidebar').removeClass('control-sidebar-open');
            $('body').removeClass('control-sidebar-open');
        });
    }

    $('#orderCancel,#orderEdit,#delivery,#orderFinish').on('hide.bs.modal', function (e) {
        $(this).removeData('bs.modal');
    })

    //modify_20170924_by_wudi start 主订单导出操作
    $('.btn-export').click(function (e) {
        e.preventDefault();
        var url = $(this).attr('href');
        var app = $(this).data('app');
        var model = $(this).data('model');

        var listArr = []
        var filter = null
        var list = $('.data-list tbody tr')
        for (var i = 0; i < list.length; i++) {
            var checked = $(list[i]).find('input[type="checkbox"]');
            if($(checked).prop('checked')==true){
                var listId = $(checked).val();
                listArr.push(listId);
            }
        };
        var tid=$('input[name=tid]').val()?$('input[name=tid]').val():'';
        var receiver_mobile=$('input[name=receiver_mobile]').val()?$('input[name=receiver_mobile]').val():'';
        var receiver_phone=$('input[name=receiver_phone]').val()?$('input[name=receiver_phone]').val():'';
        var receiver_name=$('input[name=receiver_name]').val()?$('input[name=receiver_name]').val():'';
        var keyword=$('input[name=keyword]').val()?$('input[name=keyword]').val():'';
        var user_name=$('input[name=user_name]').val()?$('input[name=user_name]').val():'';
        var status=$('select[name=status]').find('option:checked').val()?$('select[name=status]').find('option:checked').val():'';
        var create_time=$('input[name=create_time]').val()?$('input[name=create_time]').val():'';
        var supplier_id=$('select[name=supplier_id]').find('option:checked').val()?$('select[name=supplier_id]').find('option:checked').val():'';
        var is_virtual=$('select[name=is_virtual]').find('option:checked').val()?$('select[name=is_virtual]').find('option:checked').val():'';
        //导出当前表格选中的内容
        if( listArr.length > 0 ){
            filter = '{"tid|in":['+ listArr + ']}';
            $('.export-filter').attr('data-value',filter);
            $('#exportDialog').modal({remote: url}).attr('data-app',app).attr('data-model',model);
        }else{
            filter = '{"receiver_mobile":"'+receiver_mobile+'","receiver_phone":"'+receiver_phone+'","tid":"'+tid+'","receiver_name":"'+receiver_name+'","keyword":"'+keyword+'","user_name":"'+user_name+'","status":"'+status+'","supplier_id":"'+supplier_id+'","is_virtual":"'+is_virtual+'","create_time":"'+create_time+'"}';
            $('.export-filter').attr('data-value',filter);
            Modal.confirm({msg: '是否确认导出当前筛选条件下的全部订单？'}).on(function(e) {
                if(e==true) {
                    $('#exportDialog').modal({remote: url}).attr('data-app',app).attr('data-model',model);
                }
            });
        }
    })
    //modify_20170924_by_wudi_end 主订单导出操作

    //add_20170924_by_wudi_start 子订单导出操作
    $('.btn-exportorder').click(function (e) {
        e.preventDefault();
        var url = $(this).attr('href');
        var app = $(this).data('app');
        var model = $(this).data('model');

        //获取列表选中项
        var listArr = []
        var filter = null
        var list = $('.data-list tbody tr')
        for (var i = 0; i < list.length; i++) {
            var checked = $(list[i]).find('input[type="checkbox"]');
            if($(checked).prop('checked')==true){
                var listId = $(checked).val();
                listArr.push(listId);
            }
        };
        var tid=$('input[name=tid]').val()?$('input[name=tid]').val():'';
        var receiver_mobile=$('input[name=receiver_mobile]').val()?$('input[name=receiver_mobile]').val():'';
        var receiver_phone=$('input[name=receiver_phone]').val()?$('input[name=receiver_phone]').val():'';
        var receiver_name=$('input[name=receiver_name]').val()?$('input[name=receiver_name]').val():'';
        var keyword=$('input[name=keyword]').val()?$('input[name=keyword]').val():'';
        var user_name=$('input[name=user_name]').val()?$('input[name=user_name]').val():'';
        var status=$('select[name=status]').find('option:checked').val()?$('select[name=status]').find('option:checked').val():'';
        var create_time=$('input[name=create_time]').val()?$('input[name=create_time]').val():'';
        var supplier_id=$('select[name=supplier_id]').find('option:checked').val()?$('select[name=supplier_id]').find('option:checked').val():'';
        var is_virtual=$('select[name=is_virtual]').find('option:checked').val()?$('select[name=is_virtual]').find('option:checked').val():'';
        if( listArr.length > 0 ){
            filter = '{"tid|in":['+ listArr + ']}';
            $('.export-filter').attr('data-value',filter);
            $('#exportOrderDialog').modal({remote: url}).attr('data-app',app).attr('data-model',model);
        }else{
            filter = '{"receiver_mobile":"'+receiver_mobile+'","receiver_phone":"'+receiver_phone+'","tid":"'+tid+'","receiver_name":"'+receiver_name+'","keyword":"'+keyword+'","user_name":"'+user_name+'","status":"'+status+'","create_time":"'+create_time+'","supplier_id":"'+supplier_id+'","is_virtual":"'+is_virtual+'"}';
            $('.export-filter').attr('data-value',filter);
            Modal.confirm({msg: '是否确认导出当前筛选条件下的子订单？'}).on(function(e) {
                if(e==true) {
                    $('#exportOrderDialog').modal({remote: url}).attr('data-app',app).attr('data-model',model);
                }
            });
        }
    })
    //add_20170924_by_wudi_end 子订单导出操作


    //add_20170924_by_wudi_start 批量导入发货操作
    $('.btn-import').click(function (e) {
        e.preventDefault();
        var url = $(this).attr('href');
        var app = $(this).data('app');
        var model = $(this).data('model');

        var listArr = []
        var filter = null
        var list = $('.data-list tbody tr')
        for (var i = 0; i < list.length; i++) {
            var checked = $(list[i]).find('input[type="checkbox"]');
            if($(checked).prop('checked')==true){
                var listId = $(checked).val();
                listArr.push(listId);
            }
        }

        var tid=$('input[name=tid]').val()?$('input[name=tid]').val():'';
        var receiver_mobile=$('input[name=receiver_mobile]').val()?$('input[name=receiver_mobile]').val():'';
        var receiver_phone=$('input[name=receiver_phone]').val()?$('input[name=receiver_phone]').val():'';
        var receiver_name=$('input[name=receiver_name]').val()?$('input[name=receiver_name]').val():'';
        var keyword=$('input[name=keyword]').val()?$('input[name=keyword]').val():'';
        var user_name=$('input[name=user_name]').val()?$('input[name=user_name]').val():'';
        var status=$('select[name=status]').find('option:checked').val()?$('select[name=status]').find('option:checked').val():'';
        var create_time=$('input[name=create_time]').val()?$('input[name=create_time]').val():'';
        var supplier_id=$('select[name=supplier_id]').find('option:checked').val()?$('select[name=supplier_id]').find('option:checked').val():'';
        if( listArr.length > 0 ){
            filter = '{"tids":['+ listArr + ']}';
            $('.export-filter').attr('data-value',filter);
            $('#importDlyCodeDialog').modal({remote: url}).attr('data-app',app).attr('data-model',model);
            /*$('#importDlyCodeDialog').on("hidden.bs.modal",function(){
                $(this).removeData('bs.modal');
            });*/
        }else{
            filter = '{"receiver_mobile":"'+receiver_mobile+'","receiver_phone":"'+receiver_phone+'","tid":"'+tid+'","receiver_name":"'+receiver_name+'","keyword":"'+keyword+'","user_name":"'+user_name+'","status":"'+status+'","create_time":"'+create_time+'","supplier_id":"'+supplier_id+'"}';
            $('.export-filter').attr('data-value',filter);
            Modal.confirm({msg: '是否确认对当前筛选条件下的订单进行操作？'}).on(function(e) {
                if(e==true) {
                    $('#importDlyCodeDialog').modal({remote: url}).attr('data-app',app).attr('data-model',model);
                    /*$('#importDlyCodeDialog').on("hidden.bs.modal",function(){
                        $(this).removeData('bs.modal');
                    });*/
                }
            });
        }
    })
    //add_20170924_by_wudi_end 批量导入发货操作

    $(document).ready(
        function() {
            $(".sidebar .sidebar-menu li a i.glyphicon").eq(1).removeClass("glyphicon-list-alt").addClass("glyphicon-stats");
        }
    );

    // 重置表单
    $('input[name="create_time"]').val('');
    $('#reset-form').on('click',function(){
        $('input:visible').val('');
        $('.select-reset').val(-1);
    });
</script>
